<!DOCTYPE html>
<html>
<head>
    <title>Test Fixed Expenses</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';

        // Tu configuraciÃ³n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAcSvAI855I6pbTMewaMxgfRmupq7uiebM",
            authDomain: "admingastos-23a64.firebaseapp.com",
            projectId: "admingastos-23a64",
            storageBucket: "admingastos-23a64.firebasestorage.app",
            messagingSenderId: "389182314600",
            appId: "1:389182314600:web:e75e49fa37536ba02c03dd",
            measurementId: "G-7B0BH2S3L3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;

        window.signIn = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                currentUser = result.user;
                document.getElementById('status').innerHTML = `Signed in as: ${currentUser.email}`;
                document.getElementById('controls').style.display = 'block';
            } catch (error) {
                console.error('Sign in error:', error);
                document.getElementById('status').innerHTML = `Error: ${error.message}`;
            }
        };

        window.addFixedExpense = async () => {
            if (!currentUser) {
                alert('Please sign in first');
                return;
            }

            try {
                const docRef = await addDoc(collection(db, 'fixedExpenses'), {
                    descripcion: 'Test Rent',
                    monto: 1000,
                    categoria: 'hogar',
                    fechaVencimiento: 1,
                    isActive: true,
                    userId: currentUser.uid,
                    createdAt: new Date(),
                    updatedAt: new Date()
                });
                console.log('Document written with ID: ', docRef.id);
                document.getElementById('result').innerHTML = `Fixed expense added with ID: ${docRef.id}`;
            } catch (error) {
                console.error('Error adding document: ', error);
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        };

        window.getFixedExpenses = async () => {
            if (!currentUser) {
                alert('Please sign in first');
                return;
            }

            try {
                const q = query(
                    collection(db, 'fixedExpenses'),
                    where('userId', '==', currentUser.uid)
                );
                const querySnapshot = await getDocs(q);
                
                let expenses = [];
                querySnapshot.forEach((doc) => {
                    expenses.push({ id: doc.id, ...doc.data() });
                });
                
                console.log('Fixed expenses:', expenses);
                document.getElementById('result').innerHTML = `Found ${expenses.length} fixed expenses: ${JSON.stringify(expenses, null, 2)}`;
            } catch (error) {
                console.error('Error getting documents: ', error);
                document.getElementById('result').innerHTML = `Error: ${error.message}`;
            }
        };
    </script>
</head>
<body>
    <h1>Test Fixed Expenses</h1>
    
    <div id="status">Not signed in</div>
    
    <button onclick="signIn()">Sign In with Google</button>
    
    <div id="controls" style="display: none;">
        <button onclick="addFixedExpense()">Add Test Fixed Expense</button>
        <button onclick="getFixedExpenses()">Get Fixed Expenses</button>
    </div>
    
    <div id="result"></div>
</body>
</html>
